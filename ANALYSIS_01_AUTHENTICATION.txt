================================================================================
ê¸°ëŠ¥ë³„ ìƒì„¸ ë¶„ì„ ë³´ê³ ì„œ #1: í™˜ì ì¸ì¦ ì‹œìŠ¤í…œ
================================================================================
ì‘ì„±ì¼: 2025ë…„ 1ì›” 9ì¼
ë¶„ì„ ë²”ìœ„: ë°±ì—”ë“œ + í”„ë¡ íŠ¸ì—”ë“œ í†µí•©
í˜„ì¬ ì™„ì„±ë„: 95%
================================================================================

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ê´€ë ¨ íŒŒì¼ êµ¬ì¡°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ë°±ì—”ë“œã€‘
backend/nfc_hospital_system/authentication/
â”œâ”€â”€ models.py           # User, DeviceToken, LoginAttempt ëª¨ë¸
â”œâ”€â”€ views.py            # ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ/í† í° ê°±ì‹  ë·°
â”œâ”€â”€ serializers.py      # ì¸ì¦ ì‹œë¦¬ì–¼ë¼ì´ì €
â”œâ”€â”€ jwt_auth.py         # JWT ì¸ì¦ í´ë˜ìŠ¤
â”œâ”€â”€ permissions.py      # RBAC ê¶Œí•œ í´ë˜ìŠ¤
â”œâ”€â”€ urls.py            # ì¸ì¦ URL íŒ¨í„´
â””â”€â”€ hashers.py         # ë¹„ë°€ë²ˆí˜¸ í•´ì‹± (ë¯¸ì‚¬ìš©)

ã€í”„ë¡ íŠ¸ì—”ë“œã€‘
frontend-pwa/src/
â”œâ”€â”€ context/AuthContext.jsx     # ì¸ì¦ ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ pages/Login.jsx             # ë¡œê·¸ì¸ í™”ë©´
â”œâ”€â”€ pages/LoginPage.jsx         # ëŒ€ì²´ ë¡œê·¸ì¸ í™”ë©´
â”œâ”€â”€ api/client.js              # Axios ì¸í„°ì…‰í„°
â”œâ”€â”€ utils/csrf.js              # CSRF í† í° ì²˜ë¦¬
â””â”€â”€ services/axiosInstance.js  # API í´ë¼ì´ì–¸íŠ¸

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” í˜„ì¬ êµ¬í˜„ ìƒíƒœ ë¶„ì„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

================================================================================
1. ë°±ì—”ë“œ ì¸ì¦ ì‹œìŠ¤í…œ
================================================================================

ã€âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„ã€‘

1.1 ì»¤ìŠ¤í…€ User ëª¨ë¸
```python
class User(AbstractBaseUser, PermissionsMixin):
    user_id = models.UUIDField(primary_key=True, default=uuid.uuid4)
    role = models.CharField(choices=ROLE_CHOICES, default='patient')
    phone_number = models.CharField(max_length=20)
    birth_date = models.DateField()
```
- UUID ê¸°ë°˜ PKë¡œ ë³´ì•ˆì„± í–¥ìƒ âœ“
- 5ë‹¨ê³„ ì—­í•  ì‹œìŠ¤í…œ (patient/staff/dept/super/doctor) âœ“
- ê°„í¸ ë¡œê·¸ì¸ ì§€ì› (ì „í™”ë²ˆí˜¸ + ìƒë…„ì›”ì¼) âœ“
- ë¹„ë°€ë²ˆí˜¸ ì„ íƒì  (set_unusable_password) âœ“

1.2 JWT í† í° ì‹œìŠ¤í…œ
```python
def simple_login(request):
    # ê°„í¸ ë¡œê·¸ì¸ ë¡œì§
    access_payload = {
        'user_id': str(user.user_id),
        'role': user.role,
        'token_type': 'access',
        'exp': datetime.utcnow() + timedelta(hours=1)  # 1ì‹œê°„
    }
    refresh_payload = {
        'user_id': str(user.user_id),
        'token_type': 'refresh',
        'exp': datetime.utcnow() + timedelta(days=7)  # 7ì¼
    }
```
- Access Token: 1ì‹œê°„ ë§Œë£Œ âœ“
- Refresh Token: 7ì¼ ë§Œë£Œ âœ“
- httpOnly ì¿ í‚¤ ì˜µì…˜ ì§€ì› âœ“

1.3 ë””ë°”ì´ìŠ¤ í† í° ê´€ë¦¬
```python
class DeviceToken(models.Model):
    device_id = models.CharField(primary_key=True)
    token = models.CharField(unique=True)
    device_uuid = models.CharField(unique=True)
    fcm_token = models.TextField(null=True)
    is_trusted = models.BooleanField(default=False)
```
- ë‹¤ì¤‘ ë””ë°”ì´ìŠ¤ ì§€ì› êµ¬ì¡° âœ“
- FCM í‘¸ì‹œ ì•Œë¦¼ ì¤€ë¹„ âœ“
- ì‹ ë¢° ë””ë°”ì´ìŠ¤ ê´€ë¦¬ âœ“

ã€âš ï¸ ë¬¸ì œê°€ ìˆëŠ” ë¶€ë¶„ã€‘

1.4 í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë¯¸êµ¬í˜„
```python
# í˜„ì¬ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒ ì‹œ í† í° ë¬´íš¨í™” ë¶ˆê°€
def logout(request):
    response = JsonResponse({'success': True})
    response.delete_cookie('access_token')  # ì¿ í‚¤ë§Œ ì‚­ì œ
    # TODO: í† í°ì„ Redis ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•´ì•¼ í•¨
```

1.5 Race Condition ìœ„í—˜
```python
# í† í° ê°±ì‹  ì‹œ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ ì—†ìŒ
def refresh_token_view(request):
    # ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì‹œì— ì˜¤ë©´ ì¤‘ë³µ ê°±ì‹  ê°€ëŠ¥
    new_access_token = generate_access_token(user)
```

1.6 ë””ë°”ì´ìŠ¤ í† í° ë¯¸í™œìš©
```python
# DeviceToken ëª¨ë¸ì€ ìˆìœ¼ë‚˜ ì‹¤ì œ ì‚¬ìš© ì•ˆ í•¨
# simple_loginì—ì„œ ë””ë°”ì´ìŠ¤ í† í° ìƒì„±/ê²€ì¦ ë¡œì§ ì—†ìŒ
```

================================================================================
2. í”„ë¡ íŠ¸ì—”ë“œ ì¸ì¦ ì‹œìŠ¤í…œ
================================================================================

ã€âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„ã€‘

2.1 AuthContext ìƒíƒœ ê´€ë¦¬
```javascript
const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
    const [user, setUser] = useState(null);
    const [loading, setLoading] = useState(true);
    
    // ìë™ ë¡œê·¸ì¸ ì²´í¬
    useEffect(() => {
        const storedUser = localStorage.getItem('user');
        const rememberMe = localStorage.getItem('rememberMe');
        if (rememberMe === 'true' && storedUser) {
            setUser(JSON.parse(storedUser));
        }
    }, []);
```
- Context APIë¡œ ì „ì—­ ìƒíƒœ ê´€ë¦¬ âœ“
- ìë™ ë¡œê·¸ì¸ ë©”ì»¤ë‹ˆì¦˜ âœ“
- ë¡œë”© ìƒíƒœ ì²˜ë¦¬ âœ“

2.2 Axios ì¸í„°ì…‰í„°
```javascript
// ìš”ì²­ ì¸í„°ì…‰í„°: í† í° ìë™ ì¶”ê°€
apiClient.interceptors.request.use(config => {
    const token = localStorage.getItem('access_token');
    if (token) {
        config.headers.Authorization = `Bearer ${token}`;
    }
});

// ì‘ë‹µ ì¸í„°ì…‰í„°: 401 ì—ëŸ¬ ì‹œ í† í° ê°±ì‹ 
apiClient.interceptors.response.use(null, async error => {
    if (error.response?.status === 401) {
        await refreshToken();
        return apiClient(originalRequest);
    }
});
```
- JWT í† í° ìë™ ì²¨ë¶€ âœ“
- 401 ì—ëŸ¬ ìë™ ì²˜ë¦¬ âœ“
- í† í° ê°±ì‹  í›„ ì¬ì‹œë„ âœ“

2.3 ì‚¬ìš©ì ì¹œí™”ì  ë¡œê·¸ì¸ UI
```javascript
// ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ…
const formatPhoneNumber = (value) => {
    const numbers = value.replace(/\D/g, '');
    if (numbers.length <= 3) return numbers;
    if (numbers.length <= 7) return `${numbers.slice(0,3)}-${numbers.slice(3)}`;
    return `${numbers.slice(0,3)}-${numbers.slice(3,7)}-${numbers.slice(7,11)}`;
};
```
- ì „í™”ë²ˆí˜¸ ìë™ í¬ë§·íŒ… âœ“
- í° í„°ì¹˜ ì˜ì—­ (ê³ ë ¹ì ì¹œí™”) âœ“
- ì‹¤ì‹œê°„ ì…ë ¥ ê²€ì¦ âœ“

ã€âš ï¸ ë¬¸ì œê°€ ìˆëŠ” ë¶€ë¶„ã€‘

2.4 localStorage ë³´ì•ˆ ì·¨ì•½ì 
```javascript
// XSS ê³µê²©ì— ì·¨ì•½í•œ í† í° ì €ì¥
localStorage.setItem('access_token', data.access);
localStorage.setItem('refresh_token', data.refresh);
// ê³µê²©ìê°€ localStorage.getItem('access_token')ìœ¼ë¡œ íƒˆì·¨ ê°€ëŠ¥
```

2.5 í† í° ê°±ì‹  Race Condition
```javascript
// ë™ì‹œ API í˜¸ì¶œ ì‹œ ì¤‘ë³µ ê°±ì‹ 
const refreshToken = async () => {
    // ê°±ì‹  ì¤‘ í”Œë˜ê·¸ ì—†ìŒ
    const response = await fetch('/api/v1/auth/token/refresh/');
    // ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì‹œì— ê°±ì‹  ì‹œë„ ê°€ëŠ¥
};
```

2.6 Silent Refresh ë¯¸êµ¬í˜„
```javascript
// í† í° ë§Œë£Œ ì§ì „ ìë™ ê°±ì‹  ì—†ìŒ
// ì‚¬ìš©ìê°€ ê°±ì‹  ê³¼ì •ì„ ì¸ì§€í•˜ê²Œ ë¨
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”¥ ì£¼ìš” ë¬¸ì œì  ë° ì˜í–¥ë„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¬¸ì œì                 â”‚ ì‹¬ê°ë„ â”‚ ì˜í–¥ ë²”ìœ„      â”‚ ìˆ˜ì • ì‹œê°„ â”‚ ìš°ì„ ìˆœìœ„ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë¶€ì¬   â”‚ ë†’ìŒ   â”‚ ë³´ì•ˆ          â”‚ 1ì¼       â”‚ P1      â”‚
â”‚ localStorage ë³´ì•ˆ     â”‚ ë†’ìŒ   â”‚ ë³´ì•ˆ          â”‚ 2ì¼       â”‚ P1      â”‚
â”‚ Race Condition       â”‚ ì¤‘ê°„   â”‚ ì•ˆì •ì„±        â”‚ 1ì¼       â”‚ P2      â”‚
â”‚ ë””ë°”ì´ìŠ¤ í† í° ë¯¸í™œìš©  â”‚ ë‚®ìŒ   â”‚ ê¸°ëŠ¥ ì™„ì„±ë„   â”‚ 3ì¼       â”‚ P3      â”‚
â”‚ Silent Refresh ë¶€ì¬  â”‚ ë‚®ìŒ   â”‚ ì‚¬ìš©ì„±        â”‚ 1ì¼       â”‚ P3      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ ê°œì„  ë°©ì•ˆ (ìš°ì„ ìˆœìœ„ìˆœ)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

================================================================================
[P1] í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ êµ¬í˜„ (1ì¼)
================================================================================

ã€ë°±ì—”ë“œ ìˆ˜ì •ã€‘
```python
# settings.py
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.redis.RedisCache',
        'LOCATION': 'redis://127.0.0.1:6379/1',
    }
}

# jwt_auth.py
from django.core.cache import cache

class JWTBlacklist:
    @staticmethod
    def add_token(token, exp_time):
        cache.set(f"blacklist_{token}", True, timeout=exp_time)
    
    @staticmethod
    def is_blacklisted(token):
        return cache.get(f"blacklist_{token}") is not None

# views.py - logout ìˆ˜ì •
def logout(request):
    token = request.headers.get('Authorization', '').replace('Bearer ', '')
    if token:
        decoded = jwt.decode(token, settings.SECRET_KEY, algorithms=['HS256'])
        remaining_time = decoded['exp'] - int(time.time())
        JWTBlacklist.add_token(token, remaining_time)
```

================================================================================
[P1] localStorage â†’ httpOnly ì¿ í‚¤ ì „í™˜ (2ì¼)
================================================================================

ã€ë°±ì—”ë“œ ìˆ˜ì •ã€‘
```python
# views.py
def simple_login(request):
    # ... ê¸°ì¡´ ë¡œì§ ...
    
    response = JsonResponse({
        'success': True,
        'user': UserSerializer(user).data,
        # access_tokenì€ ì‘ë‹µ ë³¸ë¬¸ì—ì„œ ì œê±°
    })
    
    # httpOnly ì¿ í‚¤ë¡œë§Œ ì„¤ì •
    response.set_cookie(
        'access_token',
        access_token,
        max_age=3600,  # 1ì‹œê°„
        httponly=True,
        secure=True,    # HTTPS only
        samesite='Strict'
    )
    
    response.set_cookie(
        'refresh_token',
        refresh_token,
        max_age=604800,  # 7ì¼
        httponly=True,
        secure=True,
        samesite='Strict'
    )
```

ã€í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì •ã€‘
```javascript
// AuthContext.jsx
const login = async (phoneNumber, birthDate, rememberMe) => {
    const response = await authAPI.login(phoneNumber, birthDate);
    
    // í† í°ì€ ì¿ í‚¤ì— ì €ì¥ë˜ë¯€ë¡œ localStorageì—ì„œ ì œê±°
    // localStorage.setItem('access_token', data.access); // ì œê±°
    
    // ì‚¬ìš©ì ì •ë³´ë§Œ ì €ì¥
    localStorage.setItem('user', JSON.stringify(response.user));
};

// client.js - ì¸í„°ì…‰í„° ìˆ˜ì •
apiClient.interceptors.request.use(config => {
    // Authorization í—¤ë” ì œê±° (ì¿ í‚¤ ìë™ ì „ì†¡)
    config.withCredentials = true;  // ì¿ í‚¤ í¬í•¨
    return config;
});
```

================================================================================
[P2] Race Condition ë°©ì§€ (1ì¼)
================================================================================

ã€í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì •ã€‘
```javascript
// AuthContext.jsx
let tokenRefreshPromise = null;

const refreshTokenSafely = async () => {
    // ì´ë¯¸ ê°±ì‹  ì¤‘ì´ë©´ ê¸°ì¡´ Promise ë°˜í™˜
    if (tokenRefreshPromise) {
        return tokenRefreshPromise;
    }
    
    // ìƒˆë¡œìš´ ê°±ì‹  ì‹œì‘
    tokenRefreshPromise = authAPI.refreshToken();
    
    try {
        const result = await tokenRefreshPromise;
        return result;
    } finally {
        // ì™„ë£Œ í›„ ì´ˆê¸°í™”
        tokenRefreshPromise = null;
    }
};

// client.js - ì¸í„°ì…‰í„° ìˆ˜ì •
apiClient.interceptors.response.use(null, async error => {
    if (error.response?.status === 401 && !error.config._retry) {
        error.config._retry = true;
        
        // Race condition ë°©ì§€ëœ ê°±ì‹ 
        await refreshTokenSafely();
        
        return apiClient(error.config);
    }
    return Promise.reject(error);
});
```

ã€ë°±ì—”ë“œ ìˆ˜ì •ã€‘
```python
# views.py
from django.db import transaction

@transaction.atomic
def refresh_token_view(request):
    # íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë™ì‹œì„± ì œì–´
    with transaction.atomic():
        # í† í° ê°±ì‹  ë¡œì§
        pass
```

================================================================================
[P3] Silent Refresh êµ¬í˜„ (1ì¼)
================================================================================

ã€í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ã€‘
```javascript
// AuthContext.jsx
const scheduleTokenRefresh = (expiresIn) => {
    // ë§Œë£Œ 5ë¶„ ì „ ê°±ì‹ 
    const refreshTime = (expiresIn - 300) * 1000;
    
    setTimeout(async () => {
        try {
            await refreshTokenSafely();
            // ë‹¤ìŒ ê°±ì‹  ìŠ¤ì¼€ì¤„
            scheduleTokenRefresh(3600);  // 1ì‹œê°„
        } catch (error) {
            console.error('Silent refresh failed');
        }
    }, refreshTime);
};

// ë¡œê·¸ì¸ ì„±ê³µ ì‹œ
const login = async () => {
    // ... ë¡œê·¸ì¸ ë¡œì§ ...
    
    // Silent refresh ì‹œì‘
    scheduleTokenRefresh(3600);  // 1ì‹œê°„
};
```

================================================================================
[P3] ë””ë°”ì´ìŠ¤ ê¸°ë°˜ ìë™ ë¡œê·¸ì¸ (3ì¼)
================================================================================

ã€ë°±ì—”ë“œ êµ¬í˜„ã€‘
```python
# views.py
import hashlib

def generate_device_token(user, request):
    # ë””ë°”ì´ìŠ¤ ì •ë³´ ìˆ˜ì§‘
    device_info = {
        'user_agent': request.META.get('HTTP_USER_AGENT', ''),
        'ip_address': get_client_ip(request),
        'accept_language': request.META.get('HTTP_ACCEPT_LANGUAGE', ''),
    }
    
    # ë””ë°”ì´ìŠ¤ UUID ìƒì„±
    device_uuid = hashlib.sha256(
        json.dumps(device_info).encode()
    ).hexdigest()
    
    # DeviceToken ìƒì„±/ì—…ë°ì´íŠ¸
    device_token, created = DeviceToken.objects.update_or_create(
        device_uuid=device_uuid,
        user=user,
        defaults={
            'token': secrets.token_urlsafe(32),
            'user_agent': device_info['user_agent'],
            'last_ip_address': device_info['ip_address'],
            'last_login_at': timezone.now()
        }
    )
    
    return device_token.token

# ìë™ ë¡œê·¸ì¸ ì—”ë“œí¬ì¸íŠ¸
def device_login(request):
    device_token = request.headers.get('X-Device-Token')
    
    try:
        device = DeviceToken.objects.get(
            token=device_token,
            is_active=True
        )
        
        # ë””ë°”ì´ìŠ¤ ì •ë³´ ê²€ì¦
        if not verify_device(device, request):
            return JsonResponse({'error': 'Device mismatch'}, status=403)
        
        # JWT í† í° ë°œê¸‰
        access_token = generate_access_token(device.user)
        # ...
    except DeviceToken.DoesNotExist:
        return JsonResponse({'error': 'Invalid device'}, status=401)
```

ã€í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ã€‘
```javascript
// ë””ë°”ì´ìŠ¤ ì§€ë¬¸ ìƒì„±
const generateDeviceFingerprint = () => {
    const fp = {
        userAgent: navigator.userAgent,
        language: navigator.language,
        platform: navigator.platform,
        screenResolution: `${screen.width}x${screen.height}`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        webgl: getWebGLFingerprint(),
    };
    
    return btoa(JSON.stringify(fp));
};

// ìë™ ë¡œê·¸ì¸ ì‹œë„
const tryAutoLogin = async () => {
    const deviceToken = localStorage.getItem('device_token');
    if (!deviceToken) return false;
    
    try {
        const response = await fetch('/api/v1/auth/device-login/', {
            headers: {
                'X-Device-Token': deviceToken,
                'X-Device-Fingerprint': generateDeviceFingerprint()
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            setUser(data.user);
            return true;
        }
    } catch (error) {
        console.error('Auto login failed:', error);
    }
    
    return false;
};
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ê°œì„  í›„ ì˜ˆìƒ íš¨ê³¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ë³´ì•ˆì„± í–¥ìƒã€‘
â€¢ XSS ê³µê²© ë°©ì§€ (httpOnly ì¿ í‚¤)
â€¢ í† í° íƒˆì·¨ í›„ ì•…ìš© ë°©ì§€ (ë¸”ë™ë¦¬ìŠ¤íŠ¸)
â€¢ ë””ë°”ì´ìŠ¤ ê²€ì¦ìœ¼ë¡œ ê³„ì • ë³´í˜¸

ã€ì•ˆì •ì„± í–¥ìƒã€‘
â€¢ Race condition í•´ê²°ë¡œ API ì˜¤ë¥˜ ê°ì†Œ
â€¢ Silent refreshë¡œ ëŠê¹€ ì—†ëŠ” ì‚¬ìš©
â€¢ ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨ìœ¨ ê°ì†Œ

ã€ì‚¬ìš©ì„± í–¥ìƒã€‘
â€¢ ë§¤ë„ëŸ¬ìš´ í† í° ê°±ì‹ 
â€¢ ì‹ ë¢° ë””ë°”ì´ìŠ¤ ìë™ ë¡œê·¸ì¸
â€¢ ì˜¤ë¥˜ ë°œìƒ ì‹œ ëª…í™•í•œ ì•ˆë‚´

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€í•„ìˆ˜ êµ¬í˜„ (1ì£¼ ë‚´)ã€‘
â–¡ JWT í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (Redis)
â–¡ httpOnly ì¿ í‚¤ ì „í™˜
â–¡ Race condition ë°©ì§€
â–¡ ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ 

ã€ì„ íƒ êµ¬í˜„ (ì—¬ìœ  ìˆì„ ë•Œ)ã€‘
â–¡ Silent refresh
â–¡ ë””ë°”ì´ìŠ¤ í† í° ì‹œìŠ¤í…œ
â–¡ 2FA (2ë‹¨ê³„ ì¸ì¦)
â–¡ ìƒì²´ ì¸ì¦ (WebAuthn)

ã€í…ŒìŠ¤íŠ¸ í•­ëª©ã€‘
â–¡ ë™ì‹œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
â–¡ í† í° ë§Œë£Œ ì²˜ë¦¬
â–¡ ìë™ ë¡œê·¸ì¸ ì•ˆì •ì„±
â–¡ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬
â–¡ XSS ê³µê²© ë°©ì–´ ê²€ì¦

================================================================================
ê²°ë¡ : ì¸ì¦ ì‹œìŠ¤í…œì€ ê¸°ë³¸ ê¸°ëŠ¥ì€ ì™„ì„±ë˜ì—ˆìœ¼ë‚˜, 
     ë³´ì•ˆê³¼ ì•ˆì •ì„± ì¸¡ë©´ì—ì„œ ê°œì„ ì´ í•„ìš”í•¨
================================================================================