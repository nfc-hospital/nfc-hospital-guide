import React, { useState, useEffect } from 'react';
import InteractiveMapViewer from '../components/maps/InteractiveMapViewer';
import SimpleMapViewer from '../components/maps/SimpleMapViewer';
import './MapTest.css';

/**
 * ë³‘ì› ì§€ë„ í…ŒìŠ¤íŠ¸ í˜ì´ì§€
 * InteractiveMapViewer ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ SVG ìš”ì†Œ ì§ì ‘ í™œìš©
 */
const MapTest = () => {
  const [currentFloor, setCurrentFloor] = useState('main_1f');
  const [selectedRoom, setSelectedRoom] = useState(null);
  const [useSimple, setUseSimple] = useState(false);

  // ì¸µ ì •ë³´ - interactive SVG íŒŒì¼ ê²½ë¡œ í¬í•¨
  const floors = [
    { 
      id: 'main_1f', 
      building: 'ë³¸ê´€', 
      floor: '1ì¸µ', 
      name: 'ë³¸ê´€ 1ì¸µ',
      svgPath: '/images/maps/main_1f.interactive.svg'
    },
    { 
      id: 'main_2f', 
      building: 'ë³¸ê´€', 
      floor: '2ì¸µ', 
      name: 'ë³¸ê´€ 2ì¸µ',
      svgPath: '/images/maps/main_2f.interactive.svg'
    },
    { 
      id: 'cancer_1f', 
      building: 'ì•”ì„¼í„°', 
      floor: '1ì¸µ', 
      name: 'ì•”ì„¼í„° 1ì¸µ',
      svgPath: '/images/maps/cancer_1f.interactive.svg'
    },
    { 
      id: 'cancer_2f', 
      building: 'ì•”ì„¼í„°', 
      floor: '2ì¸µ', 
      name: 'ì•”ì„¼í„° 2ì¸µ',
      svgPath: '/images/maps/cancer_2f.interactive.svg'
    }
  ];

  // í˜„ì¬ ì„ íƒëœ ì¸µ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const getCurrentFloor = () => {
    return floors.find(f => f.id === currentFloor) || floors[0];
  };

  // ë°© ì„ íƒ í•¸ë“¤ëŸ¬
  const handleRoomSelect = (roomInfo) => {
    console.log('ë°© ì„ íƒ:', roomInfo);
    setSelectedRoom(roomInfo);
  };



  return (
    <div className="map-test-page">
      {/* í˜ì´ì§€ í—¤ë” */}
      <div className="page-header">
        <h1>ë³‘ì› ì§€ë„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
        <p>InteractiveMapViewer - SVG ìš”ì†Œ ì§ì ‘ í™œìš©</p>
        <button 
          onClick={() => setUseSimple(!useSimple)}
          style={{ marginTop: '10px', padding: '10px', background: '#007bff', color: 'white', border: 'none', borderRadius: '5px' }}
        >
          {useSimple ? 'ê³ ê¸‰ ë²„ì „ ì‚¬ìš©' : 'ê°„ë‹¨í•œ ë²„ì „ ì‚¬ìš©'}
        </button>
      </div>

      <div className="test-container">
        {/* ì¸µ ì„ íƒ íƒ­ */}
        <div className="floor-tabs">
          {floors.map(floor => (
            <div
              key={floor.id}
              className={`floor-tab ${currentFloor === floor.id ? 'active' : ''}`}
              onClick={() => {
                setCurrentFloor(floor.id);
                setSelectedRoom(null);
              }}
            >
              <span className="building-badge">{floor.building}</span>
              <span className="floor-name">{floor.floor}</span>
            </div>
          ))}
        </div>

        {/* ë©”ì¸ ì½˜í…ì¸  */}
        <div className="main-content">
          {/* ì§€ë„ ì„¹ì…˜ */}
          <div className="map-section">
            {useSimple ? (
              <SimpleMapViewer floorId={currentFloor} />
            ) : (
              <InteractiveMapViewer
                mapUrl={getCurrentFloor().svgPath}
                onRoomSelect={handleRoomSelect}
              />
            )}
          </div>

          {/* ì •ë³´ ì„¹ì…˜ */}
          <div className="info-section">
            {/* ì„ íƒëœ ë°© ì •ë³´ */}
            {selectedRoom && (
              <div className="node-info-card">
                <h3>ğŸ“ ì„ íƒëœ ìœ„ì¹˜</h3>
                <div className="info-content">
                  <div className="info-row">
                    <span className="info-label">ID:</span>
                    <span className="info-value">{selectedRoom.id}</span>
                  </div>
                  <div className="info-row">
                    <span className="info-label">ì´ë¦„:</span>
                    <span className="info-value">{selectedRoom.name}</span>
                  </div>
                  <div className="info-row highlight">
                    <span className="info-label">ì¸µ:</span>
                    <span className="info-value">{getCurrentFloor().name}</span>
                  </div>
                </div>
              </div>
            )}

            {/* ë””ë²„ê·¸ ì •ë³´ */}
            <div className="debug-info">
              <h3>ğŸ”§ ë””ë²„ê·¸ ì •ë³´</h3>
              <div className="debug-content">
                <p>í˜„ì¬ ì¸µ: {currentFloor}</p>
                <p>ì„ íƒëœ ë°©: {selectedRoom?.id || 'ì—†ìŒ'}</p>
                <p>SVG íŒŒì¼: {getCurrentFloor().svgPath}</p>
                <p>ë°©ì‹: Interactive SVG with Event Injection</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  );
};

export default MapTest;